@page "/Details/{BookId}"
@using ModelClass
@using DataAccessLayer
@using System.Collections.Generic
@inject IJSRuntime JSRuntime
@using System.Security.Claims
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager

<div class="container mt-4">
    @if (book != null)
    {
        <div>
            <h2>@book.title</h2>
            <p><strong>Author:</strong> @book.author</p>
            <p><strong>Categories:</strong> @book.categories</p>
            <p><strong>Price:</strong> Rs @book.price</p>
            <p><strong>Availability:</strong> @book.availability</p>
            <p><strong>Sellers No:</strong> @book.SellersNo</p>
        </div>

        @*
        //implement this when use messgaing    
        @if (userIsAuthenticated)
        {
            <button @onclick="StartChatWithSeller" class="btn btn-primary">Chat with seller</button>
        }
        else
        {
            <p><a href="login" class="btn btn-primary">Login to chat with seller</a></p>
        }*@
      

        <button @onclick="GoBack" class="btn btn-primary">Back to Search</button>
    }
    else
    {
        <p>Book not found.</p>
    }
</div>

@code {
    [Parameter] public string BookId { get; set; }
    private ModelBookListingDetails book;
    private List<ModelBookListingDetails> books;

    private string userName = "Guest";
    private bool userIsAuthenticated = false;

    protected override void OnInitialized()
    {
        int bookId;
        if (int.TryParse(BookId, out bookId))
        {
            books = DALBookListingDetails.GetBookListingDetails();
            book = books.FirstOrDefault(b => b.BookId == bookId);
        }
    }

    private void GoBack()
    {
        JSRuntime.InvokeVoidAsync("history.back");
    }

    protected override async Task OnInitializedAsync()
    {

        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity.IsAuthenticated)
        {
            userName = user.FindFirstValue(ClaimTypes.Name);
            userIsAuthenticated = true;
        }
    }

    
        private void StartChatWithSeller()
        {
            // Pass necessary information to the chat component
            NavigationManager.NavigateTo($"/chat/{book.SellerId}");
        }

    
}


